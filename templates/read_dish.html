<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    {% block title %}Список блюд{% endblock title %}

    {% macro category_section(name, dishes, mode='all') %}
        <div>{{ name }}</div>
        {% if dishes %}
            {% if mode == 'ready' %}
                {% set ready_dishes = False %}
                {% for dish in dishes %}
                    {% if dish.amount > 0 %}
                        {{ dish_section(dish, 'ready') }}
                        {% set ready_dishes = True %}
                    {% endif %}
                {% endfor %}
                {% if not ready_dishes %}
                    <div>Блюда ещё не приготовлены</div>
                {% endif %}
            {% else %}
                {% for dish in dishes %}
                    {{ dish_section(dish, 'all') }}
                {% endfor %}
            {% endif %}
        {% else %}
            {% if mode == 'ready' %}
                <div>Блюда ещё не приготовлены</div>
            {% else %}
                <div>Пусто</div>
            {% endif %}
        {% endif %}
    {% endmacro %}

    {% macro dish_section(dish, mode='all') %}
        <div>{{ dish.name }}</div>
        {% if mode == 'ready' and dish.amount > 0 %}
            <div>Готово: {{ dish.amount }}</div>
        {% endif %}
        {% if dish.products %}
            <div>Состав:</div>
            {% for association in dish.products %}
                {{ association.product.name }}
                {{ association.product_amount }}
                {{ association.product.measurement }}
            {% endfor %}
        {% else %}
            <div>Состав не известен</div>
        {% endif %}
        {% if mode == 'ready' %}
            <button type="button" onclick="window.location.href ='/cook/dish/{{ dish.id }}/cook'">Приготовить ещё</button>
        {% else %}
            <button type="button" onclick="window.location.href ='/cook/dish/{{ dish.id }}/edit'">Изменить блюдо</button>
            <button type="button" onclick="window.location.href ='/cook/dish/{{ dish.id }}/del'">Удалить блюдо</button>
            <button type="button" onclick="window.location.href ='/cook/dish/{{ dish.id }}/cook'">Приготовить блюдо</button>
        {% endif %}
    {% endmacro %}

    {% block content %}

    <div>Готовые блюда</div>

    {{ category_section('Завтраки', breakfasts, 'ready') }}
    {{ category_section('Салаты', salads, 'ready') }}
    {{ category_section('Супы', soups, 'ready') }}
    {{ category_section('Основные блюда', main_dishes, 'ready') }}
    {{ category_section('Напитки', drinks, 'ready') }}
    {{ category_section('Хлеб', bread, 'ready') }}

    <div>Все блюда</div>

    {{ category_section('Завтраки', breakfasts, 'all') }}
    {{ category_section('Салаты', salads, 'all') }}
    {{ category_section('Супы', soups, 'all') }}
    {{ category_section('Основные блюда', main_dishes, 'all') }}
    {{ category_section('Напитки', drinks, 'all') }}
    {{ category_section('Хлеб', bread, 'all') }}

    {% endblock content %}

    <button onclick="document.location.href='/cook/dish/add'">Создать блюдо</button>
    <button onclick="document.location.href='/cook/menu'">Назад</button>
</body>
</html>