{% extends 'layouts/sidebar_w_header.html' %}

{% from 'macros/sidebar.html' import sidebar %}

{% block title %}Меню{% endblock %}


{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="/static/styles/menus/menu.css">
    <link rel="stylesheet" href="/static/styles/macros/sidebar.css">
    <link rel="stylesheet" href="/static/styles/includes/dishes/dish_tile.css">
{% endblock %}

{% block top_bar %}
    <form id="filtersForm" style="display: none;"></form>

    <div class="top-bar__left">
        <h1 class="title left">Меню</h1>
        <p class="price">{{ menu.price }}₽</p>

    </div>

    <div class="top-bar__right">
        <div class="filters">
            <select name="type" id="menuTypeSelect" class="menu-type" form="filtersForm">
                {% if menu.type == "breakfast" %}
                    <option value="breakfast" selected>Завтрак</option>
                    <option value="lunch">Обед</option>
                {% elif menu.type == "lunch" %}
                    <option value="breakfast">Завтрак</option>
                    <option value="lunch" selected>Обед</option>
                {% else %}
                    <option value="breakfast">Завтрак</option>
                    <option value="lunch">Обед</option>
                {% endif %}
            </select>
        </div>

        <form class="buy-form" method="POST" action="/menu/{{ selected_date }}?type={{ menu.type }}">
            <input type="hidden" name="menu_id" value="{{ menu.id }}">
            <button class="buy-menu-btn accent" type="submit">Купить</button>
        </form>

    </div>
{% endblock %}   

        
{% block sidebar %}
    {% call sidebar(header='День') %}
    <ul id="daysList" class="days-list">
        {% for date in dates %}
            {% set selected = 'day--selected' if date == selected_date else '' %}
            {% set today = ' (сегодня)' if date == today_date else '' %}
            {% set type = menu.type %}

            <li class="day {{ selected }}" data-day="{{ date }}">
                <a class="day__link" href="/menu/{{ date }}?type={{ type }}">{{ date | date_fM_d }}{{ today }}</a>
            </li>
        {% endfor %}

    </ul>
    {% endcall %}
{% endblock %}
            
            
{% block main %}
    {% if not menu or not menu.dishes %}
        <p class="no-menu-message"><strong>На эту дату нет меню.</strong></p>
    {% else %}
        
    <div class="menu-grid">
        {% for dish in menu.dishes %}
            {% include 'includes/dishes/dish_tile.html' %}
        {% endfor %}
    </div>

    {% endif %}
{% endblock %}
    
    
{% block scripts %}
    <script>
        const menuTypeSelect = document.getElementById('menuTypeSelect');
        const filtersForm = document.getElementById('filtersForm');

        menuTypeSelect.addEventListener('change', function(event) {
            filtersForm.requestSubmit();
        });
    </script>    
{% endblock %}