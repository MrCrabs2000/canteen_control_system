{% extends 'layouts/header_layout.html' %}


{% block title %}{{ dish.name }}{% endblock %}


{% from 'macros/labeled_fields.html' import labeled_input %}


{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="/static/styles/dishes/dish.css">
    <link rel="stylesheet" href="/static/styles/users/user.css">
    <link rel="stylesheet" href="/static/styles/macros/labeled_fields.css">
{% endblock %}


{% block top_bar %}
    <h1 class="title left">{{ dish.name }} |
        <span class="dish__category">{{ dish.category_name }}</span>
    </h1>
{% if role == 'cook' %}
    <div class="top-bar-actions">
        <button onclick="location.href='/cook/dish/{{ dish.id }}/edit'" type="button">Изменить</button>
        <button class="danger" onclick="location.href='/cook/dish/{{ dish.id }}/del'" type="button">Удалить</button>
    </div>
{% endif %}
{% endblock %}


{% block main %}
    <div class="dish__info">
        <section class="info__section">
            <div class="section__top">
                <h2 class="section__header">Состав</h2>
            </div>

            <ul class="dish__composition">
                {% for i in range(amount_products) %}
                    <li>{{ products[i].name }} - {{ products[i].amount }} {{ products[i].measurement }}. Нужно на одно блюдо: {{ product_amounts[i] }} {{ products[i].measurement }}</li>
                {% endfor %}
            </ul>
        </section>
    {% if role == 'user' %}
        <section class="info__section">
            <div class="section__top">
                <h2 class="section__header">Ваши отзывы</h2>
                {% if not review %}
                    <button class="accent" form="newReviewForm">Сохранить</button>
                {% endif %}
            </div>
            
            <form class="dish__new-review" action="/reviews/add" id="newReviewForm" method="post">
                <input type="hidden" name="dish_id" value="{{ dish.id }}">
                <textarea class="new-review__textarea" name="content" placeholder="Новый отзыв"></textarea>
            </form>
            
            <div class="dish__reviews">
                {% for review in reviews %}
                    <div class="dish__review">
                        <h3 class="review-date">{{ review.date | date_Y_M_d }}</h3>
                        <p class="review">{{ review.content }}</p>
                    </div>
                {% endfor %}
            </div>
                
        </section>
    {% elif role == 'cook' %}
        <section class="info__section">
            <div class="section__top">
                <h2 class="section__header">Готовность</h2>
            </div>
            <div>Блюд готово: {{ dish.amount }}</div>
            <form method="post" id="cookDishForm" class="dishes-form">
                {{ labeled_input(name='amount', label='Количество', type='number') }}
                <button id="cook-dish-btn" form="cookDishForm" class="cook-btn accent">Приготовить</button>
            </form>
        </section>
    {% endif %}
    </div>
{% endblock %}